import{g as e,E as t,T as r,a,ak as s,al as o,am as n}from"./index-o4dV0oGq.js";const l="47.237.124.57",i=new class{constructor(e={baseUrl:"127.0.0.1",timeout:6e3}){this.baseUrl=e.baseUrl,this.timeout=e.timeout}request(e={url:"",data:{},method:"GET"}){let t=this.reqInterceptor(e);return new Promise(((e,r)=>{try{s({url:"",data:{},method:"GET",...t,success:t=>{400!=t.statusCode&&500!=t.statusCode&&404!=t.statusCode||r(t),e(this.resInterceptor(t))},fail:e=>{r(e)},complete:()=>{}})}catch(a){r(a)}}))}get(e){return this.request({...e,method:"GET"})}post(e){return this.request({...e,method:"POST"})}uploadFile(e){return e=this.reqInterceptor(e),new Promise(((t,r)=>{o({url:e.url,file:e.data.file,name:"file",formData:{filename:e.data.file.name},header:{Authorization:e.header.Authorization},success:e=>{e=this.resInterceptor(e),e=JSON.parse(e),t(e)},fail:e=>{r(e)}}).onProgressUpdate((t=>{e.callback&&e.callback(t)}))}))}downloadFile(e){return e=this.reqInterceptor(e),new Promise(((t,r)=>{n({url:`${e.url}?filePath=${e.data.filePath}`,success:e=>{404==e.statusCode&&r(e),t(e)},fail:e=>{r(e)}}).onProgressUpdate((t=>{e.callback&&e.callback(t)}))}))}reqInterceptor(e){return e.url=this.baseUrl+e.url,e.header={"content-type":"application/json"},e}resInterceptor(e){let{data:t}=e;return t}}({baseUrl:`http://${l}:3000/api`,timeout:1e4});i.reqInterceptor=function(t){t.url=this.baseUrl+t.url,t.header={"content-type":"application/json"};let r=e("token");return r&&(t.header.Authorization=`token ${r}`),t},i.resInterceptor=function(e){var s;let{data:o}=e;return 250==(null==(s=e.data)?void 0:s.status)&&t({icon:"error",title:"登录失效",mask:!0,duration:800}).then((()=>{r("token"),r("user"),a({url:"/pages/login/login"}).then((e=>{})).catch((e=>{}))})),o};export{i as F,l as I};
