import{u as e,M as s,b as a,D as l,t,g as i,n as r,o as u,s as d,G as n,d as o,e as c,w as f,i as _,f as m,y as p,P as g,j as k,F as y,B as h,z as w,S as b,O as C,l as x,E as v,J as E,H as j}from"./index-o4dV0oGq.js";import{g as q}from"./index.BMhr3K_w.js";import{F}from"./req.CPxC-5sD.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=(e={uid:String,fid:String,allow:Boolean})=>F.post({url:"/rejectfriends",data:{...e}}),R=$({__name:"friendRequest",setup($){let R=e(),I=s([]),L=s([]);function M(e){e.animEnd&&(e.animEnd=!1,e.open=!e.open,e.open?(e.display="display:flex;",q.to(e,{height:100,duration:.5,roundProps:"value",ease:"power2.out",onUpdate:function(){},onComplete:function(){e.animEnd=!0}})):q.to(e,{height:0,duration:.5,roundProps:"value",ease:"power2.out",onUpdate:function(){},onComplete:function(){e.display="display:none;",e.animEnd=!0}}))}async function P(e,s){switch(console.log(e,s),s){case"agree":r({url:`/pages/agreeMakeFriend/agreeMakeFriend?id=${e.source.sender}&msg=${e.source.message}`});break;case"refuse":{let s={uid:R.user._id,fid:e.source.sender,allow:!0};if(200==(await S(s)).status){let s=I.findIndex((s=>s._id==e._id));I.splice(s,1),e.status="2",L.unshift(e),v({title:"操作成功",icon:"success",duration:1e3,mask:!0})}break}case"always_refuse":{let s={uid:R.user._id,fid:e.source.sender,allow:!1};if(200==(await S(s)).status){let s=I.findIndex((s=>s._id==e._id));I.splice(s,1),e.status="3",L.unshift(e),v({title:"操作成功",icon:"success",duration:1e3,mask:!0})}break}case"refuse_a":{let s={uid:R.user._id,fid:e.source.sender,allow:!0};200==(await S(s)).status&&(e.status="2",v({title:"操作成功",icon:"success",duration:1e3,mask:!0}));break}case"always_refuse_a":{let s={uid:R.user._id,fid:e.source.sender,allow:!1};200==(await S(s)).status&&(e.status="3",v({title:"操作成功",icon:"success",duration:1e3,mask:!0}));break}}}return a((async()=>{var e;if(l({mask:!0}),t({title:"新朋友"}),!(null==(e=R.user)?void 0:e._id)){let e=i("user");e?R.user=e:r({url:"/pages/login/login"})}await((e={isclear:!0,uid:""})=>F.post({url:"/numformakefriend",data:{...e}}))({isclear:!0,uid:R.user._id})})),u((async()=>{if(!R.user._id)return d({url:"/pages/chatList/chatList"});try{let e=await((e={uid:String})=>F.post({url:"/getfriendsreq",data:{...e}}))({uid:R.user._id});200==e.status&&(I.splice(0,I.length),L.splice(0,L.length),e.data.forEach(((e,s)=>{let a={...e,open:!1,height:0,display:"display:none;",animEnd:!0};if(a.source.img=`${F.baseUrl}/static/${a.source.img}`,0==+a.status)I.push(a);else L.push(a)})))}catch(e){console.log(e)}n()})),(e,s)=>{const a=E,l=_,t=j,i=b;return o(),c(l,{class:"friendRequstLayout"},{default:f((()=>[m(l,{class:"friendRequst"},{default:f((()=>[m(i,{"scroll-y":"",class:"friendRequstScroll","show-scrollbar":!1},{default:f((()=>[m(l,{class:"scroll-content"},{default:f((()=>[(o(!0),p(y,null,g(k(I),((e,s)=>(o(),c(l,{class:"scroll-item"},{default:f((()=>[m(l,{class:"show",onClick:s=>M(e)},{default:f((()=>[m(l,{class:"avatar"},{default:f((()=>[m(a,{src:e.source.img,mode:"widthFix"},null,8,["src"])])),_:2},1024),m(l,{class:"name-msg"},{default:f((()=>[m(l,{class:"name"},{default:f((()=>[h(C(e.source.sender==k(R).user._id?e.friendNickname:e.source.username),1)])),_:2},1024),m(l,{class:"msg"},{default:f((()=>[h(C(e.source.sender==k(R).user._id?"我: ":"")+" "+C(e.source.message),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"]),m(l,{class:"operation",style:x([k(I)[s].display,`height:${k(I)[s].height}rpx;`])},{default:f((()=>[e.source.sender!=k(R).user._id?(o(),c(t,{key:0,class:"agree",onClick:s=>P(e,"agree")},{default:f((()=>[h("同意")])),_:2},1032,["onClick"])):w("",!0),e.source.sender!=k(R).user._id?(o(),c(t,{key:1,class:"refuse",onClick:s=>P(e,"refuse")},{default:f((()=>[h("拒绝")])),_:2},1032,["onClick"])):w("",!0),e.source.sender!=k(R).user._id?(o(),c(t,{key:2,class:"always-refuse",onClick:s=>P(e,"always_refuse")},{default:f((()=>[h(" 拒绝并禁止再次申请 ")])),_:2},1032,["onClick"])):w("",!0),e.source.sender==k(R).user._id?(o(),c(t,{key:3,class:"wait",disabled:"false"},{default:f((()=>[h(" 等待对方同意 ")])),_:1})):w("",!0)])),_:2},1032,["style"])])),_:2},1024)))),256)),k(L).length?(o(),c(l,{key:0,class:"title"},{default:f((()=>[h("已操作")])),_:1})):w("",!0),(o(!0),p(y,null,g(k(L),((e,s)=>(o(),c(l,{class:"scroll-item"},{default:f((()=>[m(l,{class:"show",onClick:s=>M(e)},{default:f((()=>[m(l,{class:"avatar"},{default:f((()=>[m(a,{src:e.source.img,mode:"widthFix"},null,8,["src"])])),_:2},1024),m(l,{class:"name-msg"},{default:f((()=>[m(l,{class:"name"},{default:f((()=>[h(C(e.source.sender==k(R).user._id?e.friendNickname:e.source.username),1)])),_:2},1024),m(l,{class:"msg"},{default:f((()=>[h(C(e.source.sender==k(R).user._id?"我: ":"")+" "+C(e.source.message),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"]),m(l,{class:"operation",style:x([e.display,`height:${e.height}rpx;`])},{default:f((()=>[e.source.sender!=k(R).user._id?(o(),c(t,{key:0,class:"agree",disabled:!0},{default:f((()=>[h("同意")])),_:1})):w("",!0),e.source.sender!=k(R).user._id?(o(),c(t,{key:1,class:"refuse",disabled:2==e.status,onClick:s=>P(e,"refuse_a")},{default:f((()=>[h("拒绝")])),_:2},1032,["disabled","onClick"])):w("",!0),e.source.sender!=k(R).user._id?(o(),c(t,{key:2,class:"always-refuse",disabled:!(2==e.status),onClick:s=>P(e,"always_refuse_a")},{default:f((()=>[h("禁止再次申请")])),_:2},1032,["disabled","onClick"])):w("",!0),e.source.sender==k(R).user._id?(o(),c(t,{key:3,class:"wait",disabled:"false"},{default:f((()=>[h(C(2==e.status?"对方已拒绝":"对方已拒绝并且禁止再次申请"),1)])),_:2},1024)):w("",!0)])),_:2},1032,["style"])])),_:2},1024)))),256))])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-3a1be205"]]);export{R as default};
