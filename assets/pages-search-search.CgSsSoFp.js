import{r as s,M as a,u as e,o as t,b as l,t as r,g as u,n as i,d,e as n,w as o,i as c,f,j as h,a3 as m,B as _,y as b,P as p,F as k,z as g,D as x,G as S,I as C,H as v,J as y,S as I,O as w,h as T,Q as E}from"./index-o4dV0oGq.js";import{_ as $}from"./zwxx.CfEKV5i5.js";import{F as j}from"./req.CPxC-5sD.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";async function F(s={uid:String,fid:Array}){let a=await((s={uid:String,fid:Array})=>{let a=[];return s.fid.forEach((e=>{a.push(j.post({url:"/checkstatus",data:{uid:s.uid,fid:e}}))})),Promise.allSettled(a)})({uid:s.uid,fid:s.fid}),e=[];a.forEach(((s,a)=>{"rejected"==s.status&&e.push(a)}));let t=[];return a.forEach((s=>{t.push(s.value)})),{res:t,reqErrIndex:e}}const D=q({__name:"search",setup(q){let D=s(""),U=a([]),V=e(),z=`${j.baseUrl}/static/`,A=s(2),L="";async function N(){if(""==D.value.trim())return;if(D.value.trim()==L)return;L=D.value.trim(),x({title:"搜索中"});let s=await P();A.value=+s,S()}async function P(){let s=await((s={search:String|Number,page:null|Number})=>j.post({url:"/searchuser",data:{...s}}))({search:D.value});if(200==s.status){let{data:a}=s;if(a.length>0){let s=[];a.forEach((a=>{s.push(a._id)}));let e=await F({uid:V.user._id,fid:s});if(e.reqErrIndex.length>0){let a=[];e.reqErrIndex.forEach((e=>{a.push(s[e])})),V.user._id}else for(let t=0;t<a.length;t++)switch(a[t].btnStatus=e.res[t].status,e.res[t].status){case 200:a[t].btnStatusText="发送消息",a[t].isColok=!0;break;case 211:a[t].btnStatusText="已申请",a[t].isColok=!1;break;case 213:a[t].btnStatusText="再次申请",a[t].isColok=!0;break;case 214:a[t].btnStatusText="禁止申请",a[t].isColok=!1;break;case 215:a[t].btnStatusText="对方已申请",a[t].isColok=!0;break;case 216:a[t].btnStatusText="已拒绝",a[t].isColok=!1;break;case 217:a[t].btnStatusText="已禁止申请",a[t].isColok=!1;break;default:a[t].btnStatusText="加好友",V.user._id==a[t]._id&&(a[t].btnStatusText="发送消息",a[t].btnStatus=200),a[t].isColok=!0}}U.splice(0,U.length);for(let s=0;s<a.length;s++)a[s].img=`${z}${a[s].img}`,U.push(a[s]);return a.length}}return t((()=>{""!=D.value.trim()&&P()})),l((()=>{r({title:"搜索"});let s=u("user");s?V.user=s:i({url:"/pages/login/login"})})),(s,a)=>{const e=C,t=c,l=v,r=y,u=I;return d(),n(t,{class:"searchLayout"},{default:o((()=>[f(t,{class:"search"},{default:o((()=>[f(t,{class:"search-input"},{default:o((()=>[f(e,{modelValue:h(D),"onUpdate:modelValue":a[0]||(a[0]=s=>m(D)?D.value=s:D=s),placeholder:"请输入昵称或者ID",onConfirm:N},null,8,["modelValue"])])),_:1}),f(t,{class:"search-btn"},{default:o((()=>[f(l,{onClick:N},{default:o((()=>[_("搜索")])),_:1})])),_:1})])),_:1}),f(u,{"scroll-y":!0,"show-scrollbar":!1},{default:o((()=>[f(t,{class:"scrollhLayout"},{default:o((()=>[(d(!0),b(k,null,p(h(U),(s=>(d(),n(t,{class:"scroll-item",onClick:a=>{return e=s.userId,t=s.btnStatus,void i({url:`/pages/user/user?userId=${e}&friendStatus=${t}`});var e,t},key:s._id},{default:o((()=>[f(t,{class:"scroll-item-img"},{default:o((()=>[f(r,{src:s.img,mode:"widthFix"},null,8,["src"])])),_:2},1024),f(t,{class:"scroll-item-name"},{default:o((()=>[f(t,{class:"name"},{default:o((()=>[_(w(s.nickname),1)])),_:2},1024),f(t,{class:"id"},{default:o((()=>[f(t,{class:"tip"},{default:o((()=>[_("ID :")])),_:1}),f(t,{class:"num"},{default:o((()=>[_(w(s.userId),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(t,{class:T(["scroll-item-btn",s.isColok?"":"disabled"])},{default:o((()=>[f(t,{class:T(["stastus"]),onClick:E((a=>function(s){if(s.isColok)switch(+s.btnStatus){case 200:i({url:`/pages/chat/chat?my=${V.user._id}&target=${s._id}`});break;case 215:i({url:"/pages/friendRequest/friendRequest"});break;case 218:i({url:`/pages/addFriend/addFriend?userId=${s.userId}`})}}(s)),["stop"])},{default:o((()=>[_(w(s.btnStatusText),1)])),_:2},1032,["onClick"])])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),0==h(A)?(d(),n(t,{key:0,class:"noUser"},{default:o((()=>[f(r,{src:$,mode:"widthFix",class:"img"})])),_:1})):g("",!0)])),_:1})}}},[["__scopeId","data-v-5a5646d5"]]);export{D as default};
