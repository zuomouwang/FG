import{u as a,M as s,r as e,b as t,D as l,s as o,o as c,G as n,d as u,e as r,w as i,Q as d,i as f,f as p,j as m,l as g,B as _,O as h,n as v,ab as k,R as x,ad as b,J as C}from"./index-o4dV0oGq.js";import{g as $}from"./index.BMhr3K_w.js";import{a as M}from"./common.mgsQid_K.js";import{F as y}from"./req.CPxC-5sD.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D=w({__name:"user",setup(w){let D=a(),I=0,S=0,j="",T=s({}),F=e("发送消息");const L=`top:${M()+10}px;`;let q=0,R=0,U=0,X=0,Y=e("top:20%;"),B=e("transform: scale(1);"),G=!0,J={top:20,scale:1,topDiff:.15,scaleDiff:.002,scaleMax:1.4,topMax:60,topConst:20,scaleConst:1,scaleChangeStart:25,duration:.3};function N(){v({url:`/pages/info/info?id=${I}`})}function O(a){if(!G)return;X=a.changedTouches[0].clientX,R=a.changedTouches[0].clientY;const s=Math.abs(X-U),e=Math.abs(R-q);s>e||(e>s&&(R<q?(J.top=J.top-J.topDiff,J.top<0?J.top=0:J.top=J.top,J.top>J.scaleChangeStart&&J.top<=J.topMax?(J.scale=J.scale-J.scaleDiff,J.scale<J.scaleConst?J.scale=J.scaleConst:J.scale=J.scale):J.scale=J.scaleConst,Y.value=`top:${J.top}%;`,B.value=`transform: scale(${J.scale});`):R>q&&(J.top=J.top+J.topDiff,J.top>J.topMax?J.top=J.topMax:J.top=J.top,J.top>J.scaleChangeStart&&J.top<=J.topMax?(J.scale=J.scale+J.scaleDiff,J.scale>J.scaleMax?J.scale=J.scaleMax:J.scale=J.scale):J.scale=J.scaleConst,Y.value=`top:${J.top}%;`,B.value=`transform: scale(${J.scale});`)),U=a.changedTouches[0].clientX,q=a.changedTouches[0].clientY)}function P(a){G=!1,$.to(J,{top:J.topConst,scale:J.scaleConst,duration:J.duration,roundProps:"value",ease:"power2.out",onUpdate:function(){Y.value=`top:${J.top}%;`,B.value=`transform: scale(${J.scale});`},onComplete:function(){G=!0}})}function Q(){k({urls:[T.img]})}function z(){x((()=>{n()}))}function A(){switch(S){case 200:v({url:`/pages/chat/chat?my=${D.user._id}&target=${T._id}`});break;case 215:v({url:"/pages/friendRequest/friendRequest"});break;case 218:v({url:`/pages/addFriend/addFriend?userId=${T.userId}`})}}function E(){b(1)}return t((async a=>{if(console.log(26),l({mask:!0}),I=a.userId,!D.user)return o({url:"/pages/chatList/chatList"});S=+a.friendStatus,a.remark&&(j=a.remark||"")})),c((async()=>{try{console.log(27);let a=await((a=Number|String)=>y.get({url:"/getuserinfo_userId",data:{id:a}}))(I);if(200===a.status)for(let s in a.data)T[s]=a.data[s];T.img=`${y.baseUrl}/static/${T.img}`,S||(a=await((a={uid:String,fid:String})=>y.post({url:"/checkstatus",data:{...a}}))({uid:D.user._id,fid:T._id}),a.status>=200&&a.status<219&&(S=+a.status))}catch(a){console.log(a),console.log("获取用户信息失败"),n()}switch(S){case 200:F.value="发送消息";break;case 211:F.value="等待对方同意";break;case 213:F.value="再次申请";break;case 214:F.value="禁止申请";break;case 215:F.value="对方已申请";break;case 216:F.value="已拒绝";break;case 217:F.value="已禁止申请";break;default:F.value="添加好友"}})),(a,s)=>{const e=f,t=C;return u(),r(e,{class:"userLayout",onTouchmove:d(O,["stop","prevent"]),onTouchend:P},{default:i((()=>[p(e,{class:"back iconfont icon-fenxiang",style:L,onClick:E}),p(e,{class:"img"},{default:i((()=>[p(t,{src:m(T).img,mode:"widthFix",style:g(m(B)),class:"image_"},null,8,["src","style"])])),_:1}),p(e,{class:"content",style:g(m(Y))},{default:i((()=>[p(e,{class:"header"},{default:i((()=>[p(e,{class:"avatar"},{default:i((()=>[p(t,{onLoad:z,onClick:Q,src:m(T).img,mode:"widthFix"},null,8,["src"])])),_:1}),p(e,{class:"username-id"},{default:i((()=>[p(e,{class:"friendnickname"},{default:i((()=>[_(h(m(j)?m(j):m(T).nickname),1)])),_:1}),p(e,{class:"username"},{default:i((()=>[p(e,{class:"tip"},{default:i((()=>[_("昵称:")])),_:1}),_(" "+h(m(T).nickname),1)])),_:1}),p(e,{class:"userid"},{default:i((()=>[p(e,{class:"tip"},{default:i((()=>[_("ID:")])),_:1}),_(" "+h(m(T).userId),1)])),_:1})])),_:1})])),_:1}),p(e,{class:"info",onClick:N},{default:i((()=>[p(e,null,{default:i((()=>[_("详细信息")])),_:1}),p(e,{class:"iconfont icon-fenxiang"})])),_:1}),p(e,{class:"introduction"},{default:i((()=>[p(e,{class:"title"},{default:i((()=>[_("个人简介")])),_:1}),p(e,{class:"text"},{default:i((()=>{var a;return[_(h((null==(a=m(T).introduce)?void 0:a.length)>0?m(T).introduce:"这个人很奇怪,什么都没有写"),1)]})),_:1})])),_:1})])),_:1},8,["style"]),p(e,{class:"footer"},{default:i((()=>[p(e,{class:"button",onClick:A},{default:i((()=>[_(h(m(F)),1)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-cad6fca3"]]);export{D as default};
