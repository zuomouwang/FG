import{r as e,d as s,e as a,w as t,f as l,l as r,j as u,k as i,i as n,J as o,q as c,K as d,L as f,u as m,M as _,b as h,t as g,g as p,n as v,o as y,N as w,B as b,O as x,y as I,P as $,F as k,z as j,E as S,S as C,Q as F}from"./index-o4dV0oGq.js";import{_ as M}from"./zwxx.CfEKV5i5.js";import{g as T,p as D}from"./common.mgsQid_K.js";import{_ as X}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{F as q}from"./req.CPxC-5sD.js";const z=X({__name:"uni-header",props:{url:{type:String,default:"http://154.21.201.134:3000/api/static/user.jpg"}},emits:["userInfo"],setup(c,{emit:d}){let f=d;const m=c;let _=e(`height:${T()}px;`),h=e(`top:${T()}px;`);return(e,c)=>{const d=n,g=o;return s(),a(d,{class:"header"},{default:t((()=>[l(d,{class:"mark",style:r(u(_))},null,8,["style"]),l(d,{class:"chat-header",style:r(u(h))},{default:t((()=>[l(g,{src:m.url,mode:"aspectFill",class:"author",onClick:c[0]||(c[0]=e=>{f("userInfo")})},null,8,["src"]),i(e.$slots,"mid",{},void 0,!0),i(e.$slots,"right",{},void 0,!0)])),_:3},8,["style"])])),_:3})}}},[["__scopeId","data-v-56bcf6a8"]]),L=X({__name:"uni-move",emits:["leftSwipe","rightSwipe"],setup(o,{emit:m}){const{proxy:_}=f(),h=m;let g=e(0),p=c((()=>`transform: translateX(${g.value}px);`)),v=e(null),y=0,w=0,b=0,x=0,I=0,$=0,k=!0;function j(e){k&&(y=e.touches[0].pageX,w=e.touches[0].pageY)}function S(e){var s;if(k&&(x=e.touches[0].pageX-y,I=e.touches[0].pageY-w,Math.abs(x)>Math.abs(I)&&Math.abs(x)>0)){if(x>0&&g.value<0){let e=g.value+x-b;e>0&&(e=0),s=e,g.value=s,b=x,h("rightSwipe")}x<0&&(d().in(_).select(".hide").boundingClientRect().exec((e=>{if(e&&e[0]){const s=e[0].width;$=s}else $=200})),g.value<=-$||(!function(e){g.value=e}(g.value+x-b),b=x,h("leftSwipe")))}}function C(e,s,a){let t=e.value,l=t/(a/10),r=setInterval((()=>{t>s?e.value+=l:e.value-=l,e.value<=s-l&&e.value>=s+l&&(e.value=s,clearInterval(r),k=!0)}),10)}function F(){k&&(y=0,w=0,x=0,I=0,b=0,k=!1,g.value>-$/2.5?C(g,0,200):C(g,-$,200))}return(e,o)=>{const c=n;return s(),a(c,{class:"box",onTouchstart:j,onTouchmove:S,onTouchend:F},{default:t((()=>[l(c,{class:"move",style:r(u(p))},{default:t((()=>[l(c,{class:"show"},{default:t((()=>[i(e.$slots,"show",{},void 0,!0)])),_:3}),l(c,{class:"hide",ref_key:"hideNode",ref:v},{default:t((()=>[i(e.$slots,"hide",{},void 0,!0)])),_:3},512)])),_:3},8,["style"])])),_:3})}}},[["__scopeId","data-v-2ae1014b"]]),N=X({__name:"chatList",setup(i){let c=e(""),d=m(),f=_([]),T=`${q.baseUrl}/static/`,X=e(!1),N=null;function R(){console.log(d.user._id,25),v({url:`/pages/user/user?userId=${d.user._id}&friendStatus=200`})}function U(){X.value=!0,setTimeout((()=>{!async function(){switch(await Y()){case!0:S({title:"刷新成功",icon:"success",duration:500}),X.value=!1;break;case!1:S({title:"刷新失败",icon:"error",duration:500}),X.value=!1}}()}),1e3)}async function Y(){try{let e=await((e={uid:""})=>q.post({url:"/getmessagelist",data:{...e}}))({uid:d.user._id});if(f.splice(0,f.length),200==e.status){for(let s of e.data)s.img=`${T}${s.img}`,1==s.type?s.last_message="[图片]":3==s.type&&(s.last_message="[文件]"),f.push(s);return!0}return!1}catch(e){return!1}}return h((()=>{if(g({title:"聊天列表"}),!d.user){let e=p("user");e?d.user=e:v({url:"/pages/login/login"})}N=setInterval((async()=>{Y()}),2e3)})),y((()=>{let e=p("user");d.user=e,c.value=e.nickname,Y()})),w((()=>{clearInterval(N)})),(e,i)=>{const m=n,_=o,h=C;return s(),a(m,{class:"chatlaout"},{default:t((()=>{var e;return[l(z,{url:u(T)+(null==(e=u(d).user)?void 0:e.img),onUserInfo:R},{mid:t((()=>[l(m,{class:"name-status"},{default:t((()=>[l(m,{class:"name"},{default:t((()=>[b(x(u(c)),1)])),_:1}),l(m,{class:"status"},{default:t((()=>[l(m,{class:"online"}),l(m,{class:"describe"},{default:t((()=>[b("在线")])),_:1})])),_:1})])),_:1})])),_:1},8,["url"]),l(m,{class:"chat"},{default:t((()=>[l(m,{class:"chat-center"},{default:t((()=>[l(h,{class:"scrollView","scroll-y":!0,"refresher-enabled":"",onRefresherrefresh:U,"refresher-triggered":u(X),"show-scrollbar":!1},{default:t((()=>[(s(!0),I(k,null,$(u(f),(e=>(s(),a(m,{class:"scroll-view-item",onClick:s=>{var a;v({url:`/pages/chat/chat?my=${(a=e).myID}&target=${a.targetID}&remark=${a.targetname}`})},key:e.targetID},{default:t((()=>[l(L,null,{show:t((()=>[l(m,{class:"move"},{default:t((()=>[l(m,{class:"item_img"},{default:t((()=>[l(_,{src:e.img,mode:"widthFix"},null,8,["src"])])),_:2},1024),l(m,{class:"item_right"},{default:t((()=>[l(m,{class:"item_name_time"},{default:t((()=>[l(m,{class:"name"},{default:t((()=>[b(x(e.targetname),1)])),_:2},1024),l(m,{class:"time"},{default:t((()=>[b(x(u(D)(+e.time)),1)])),_:2},1024)])),_:2},1024),l(m,{class:"item_msg_unread"},{default:t((()=>[l(m,{class:"msg"},{default:t((()=>[b(x(e.last_message),1)])),_:2},1024),l(m,{class:"unread",style:r([0==e.unreadmsg?"display:none":""])},{default:t((()=>[b(x(e.unreadmsg),1)])),_:2},1032,["style"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),hide:t((()=>[l(m,{class:"hide"},{default:t((()=>[l(m,{class:"item_del",onClick:i[0]||(i[0]=F((e=>{return s=1,void console.log(s);var s}),["stop"]))},{default:t((()=>[b(" 删除 ")])),_:1})])),_:1})])),_:2},1024)])),_:2},1032,["onClick"])))),128)),l(m,{class:"bottom",style:r(u(f).length>3?"":"height:50vh;")},{default:t((()=>[0==u(f).length?(s(),a(_,{key:0,src:M,mode:"widthFix",class:"img"})):j("",!0),0==u(f).length?(s(),a(m,{key:1,class:"text"},{default:t((()=>[b(x(0==u(f).length?"暂无消息":""),1)])),_:1})):j("",!0)])),_:1},8,["style"])])),_:1},8,["refresher-triggered"])])),_:1})])),_:1})]})),_:1})}}},[["__scopeId","data-v-6775aff2"]]);export{N as default};
